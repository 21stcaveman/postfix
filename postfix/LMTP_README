Postfix LMTP support
====================

Postfix LMTP support was initially implemented by Philip A.
Prindeville of Mirapoint, Inc., USA, and was modified further by
Amos Gouaux of University of Texas at Dallas, Richardson, USA.
Wietse then beat the code into its present shape.

Postfix can be configured to talk to a local or remote LMTP server.
Most people will run the LMTP server on the same machine that runs
Postfix. However, a remote LMTP server can be useful if Postfix
runs on mail relay server(s) that feed incoming mail directly to
the appropriate mailbox server(s). This way, mailbox servers do
not need to run an SMTP server at all.  Tidy all the way around.

Configuring the mailbox server (local or remote)
================================================

On the mailbox server, in this case a CMU Cyrus imapd/popd server,
add the following to /etc/services:

    pop3            110/tcp                         # Cyrus POP3
    imap            143/tcp                         # Cyrus IMAP4
    lmtp            24/tcp

Next, put the following in /etc/inetd.conf:

    lmtp    stream  tcp     nowait  cyrus   /usr/sbin/tcpd  /usr/local/cyrus/bin/deliver -e -l

/usr/sbin/tcpd is from the tcp_wrappers package.  You want this
to make sure only your mail relay(s) can talk to the LMTP server.
Postfix by default enables connection cacheing for delivery via
LMTP, so do not worry about the load of wrapping the LMTP port.

Configuring Postfix
===================

Similar changes to /etc/services:

    lmtp            24/tcp

You may have to add the following entry to /etc/postfix/master.cf:

    lmtp      unix  -       -       n       -       -       lmtp

NOTES:  Root privs are not necessary!

We put this in /etc/postfix/transport:

    inbox.domain.org     lmtp:inbox.domain.org

Naturally, this means we also have to have in 
/etc/postfix/main.cf:

    transport_maps      = hash:/etc/postfix/transport

Use the map type of your choice. Use "postconf -m" to find out
what map types are supported.

Connection cacheing performance
===============================

After delivering a message via LMTP, Postfix will keep the connection
open for a while, so that it can be reused for a subsequent delivery.
This reduces overhead of LMTP servers that create one process per
connection.  

The Postfix LMTP client makes only one connection at a time. For
connection cacheing to work well, the Postfix LMTP client has to
avoid switching destination hosts. If you have multiple LMTP servers,
configure separate master.cf entries for each LMTP server, and
configure transport entries that distribute mail domains to the
right LMTP servers.

    /etc/postfix/transport:
        foo.com lmtp1:lmtp1host
        bar.com lmtp2:lmtp2host

    /etc/postfix/master.cf:
        lmtp1      unix  -       -       n       -       -       lmtp
        lmtp2      unix  -       -       n       -       -       lmtp
