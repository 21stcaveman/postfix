The Postfix fast ETRN service
=============================

The SMTP ETRN command was designed for sites that have intermittent
Internet connectivity. With ETRN, a site can tell the mail server
of its network provider "Please deliver all my mail now".

Postfix versions before 20001001 implemented the ETRN command in
a lame manner: they would attempt to deliver all queued mail.  This
is slow on mail servers that queue mail for many customers.

The Postfix "fast ETRN" service speeds up deliveries by looking
only at mail that is queued for a given destination site. Postfix
"slow ETRN" is still used as a fall-back method.

The "fast ETRN" service uses the new "fast flush" service which
maintains per-destination logfiles of queued mail.  The "fast flush"
service is enabled by default:

    fast_flush_domains = $relay_domains

By default, Postfix "fast ETRN" service is available only for
destinations that the local MTA is willing to relay mail to.  

To disable the "fast ETRN" service, specify an empty string:

    fast_flush_domains = 

The syntax of the fast_flush_domains parameter is exactly the
same as for the relay_domains parameter: a list of domain names,
files with domain names, or maptype:mapname lookup tables where
the right-hand side is ignored.

For destinations that cannot have "fast ETRN" service, Postfix
falls back to the old "slow ETRN" service that attempts to deliver
all queued mail.

By default, every site can issue ETRN commands to your SMTP
server:

    smtpd_etrn_restrictions = 

To test the "fast ETRN" service, telnet to the Postfix SMTP server
from a client that is allowed to execute ETRN commands, and type:

    helo my.client.name
    etrn some.customer.domain

where "some.customer.domain" is the name of a domain that your mail
server is willing to relay mail to.

In the maillog file, you should see something logged like:

    created fast ETRN cache for some.customer.domain

It will then do a "slow ETRN" once. The next time the same ETRN
command is given, Postfix will do "fast ETRN".

If Postfix logs that it cannot create a fast ETRN cache for
"some.customer.domain", then execute the command "postfix check".
You probably skipped some installation instructions so that the
necessary directories were not created.

If Postfix logs that it uses slow ETRN service for "some.customer.domain",
instead of creating a fast ETRN cache, then either "some.customer.domain"
was not found in the DNS, or it was not listed as a valid fast ETRN
destination.  Check your fast_flush_domains or relay_domains settings.
