SHELL	= /bin/sh

# For now, just hard-coded rules for daemons, commands, config files.

DAEMONS	= man8/bounce.8 man8/defer.8 man8/cleanup.8 man8/error.8 man8/local.8 \
	man8/lmtp.8 man8/master.8 man8/pickup.8 man8/pipe.8 man8/qmgr.8 \
	man8/showq.8 man8/smtp.8 man8/smtpd.8 man8/trivial-rewrite.8 \
	man8/nqmgr.8
COMMANDS= man1/postalias.1 man1/postcat.1 man1/postconf.1 man1/postfix.1 \
	man1/postkick.1 man1/postlock.1 man1/postlog.1 man1/postdrop.1 \
	man1/postmap.1 man1/sendmail.1 man1/mailq.1 man1/newaliases.1 \
	man1/postsuper.1
CONFIG	= man5/access.5 man5/aliases.5 man5/canonical.5 man5/relocated.5 \
	man5/transport.5 man5/virtual.5 man5/pcre_table.5 man5/regexp_table.5

update:	$(DAEMONS) $(COMMANDS) $(CONFIG)

Makefile: Makefile.in
	(set -e; echo "# DO NOT EDIT"; $(OPTS) $(SHELL) ../makedefs; cat $?) >$@

clean:
	rm -f cat?/*

tidy:	clean

clobber:
	rm -f $(DAEMONS) $(COMMANDS) $(CONFIG)

man8/bounce.8: ../bounce/bounce.c
	../mantools/srctoman $? >$@

man8/defer.8:
	echo .so man8/bounce.8 >$@

man8/cleanup.8: ../cleanup/cleanup.c
	../mantools/srctoman $? >$@

man8/error.8: ../error/error.c
	../mantools/srctoman $? >$@

man8/local.8: ../local/local.c
	../mantools/srctoman $? >$@

man8/lmtp.8: ../lmtp/lmtp.c
	../mantools/srctoman $? >$@

man8/master.8: ../master/master.c
	../mantools/srctoman $? >$@

man8/nqmgr.8: ../nqmgr/qmgr.c
	../mantools/srctoman $? | \
		sed -e 's/qmgr[^_]/n&/' -e 's/QMGR[^_]/N&/' >$@

man8/pickup.8: ../pickup/pickup.c
	../mantools/srctoman $? >$@

man8/pipe.8: ../pipe/pipe.c
	../mantools/srctoman $? >$@

man8/qmgr.8: ../qmgr/qmgr.c
	../mantools/srctoman $? >$@

man8/showq.8: ../showq/showq.c
	../mantools/srctoman $? >$@

man8/smtp.8: ../smtp/smtp.c
	../mantools/srctoman $? >$@

man8/smtpd.8: ../smtpd/smtpd.c
	../mantools/srctoman $? >$@

man8/trivial-rewrite.8: ../trivial-rewrite/trivial-rewrite.c
	../mantools/srctoman $? >$@

man1/postalias.1: ../postalias/postalias.c
	../mantools/srctoman $? >$@

man1/postcat.1: ../postcat/postcat.c
	../mantools/srctoman $? >$@

man1/postconf.1: ../postconf/postconf.c
	../mantools/srctoman $? >$@

man1/postdrop.1: ../postdrop/postdrop.c
	../mantools/srctoman $? >$@

man1/postfix.1: ../postfix/postfix.c
	../mantools/srctoman $? >$@

man1/postkick.1: ../postkick/postkick.c
	../mantools/srctoman $? >$@

man1/postlock.1: ../postlock/postlock.c
	../mantools/srctoman $? >$@

man1/postlog.1: ../postlog/postlog.c
	../mantools/srctoman $? >$@

man1/postmap.1: ../postmap/postmap.c
	../mantools/srctoman $? >$@

man1/postsuper.1: ../postsuper/postsuper.c
	../mantools/srctoman $? >$@

man1/sendmail.1: ../sendmail/sendmail.c
	../mantools/srctoman $? >$@

man1/mailq.1:
	echo .so man1/sendmail.1 >$@

man1/newaliases.1:
	echo .so man1/sendmail.1 >$@

man5/access.5: ../proto/access
	../mantools/srctoman - $? >$@

man5/aliases.5: ../proto/aliases
	../mantools/srctoman - $? >$@

man5/canonical.5: ../proto/canonical
	../mantools/srctoman - $? >$@

man5/pcre_table.5: ../proto/pcre_table
	../mantools/srctoman - $? >$@

man5/regexp_table.5: ../proto/regexp_table
	../mantools/srctoman - $? >$@

man5/relocated.5: ../proto/relocated
	../mantools/srctoman - $? >$@

man5/transport.5: ../proto/transport
	../mantools/srctoman - $? >$@

man5/virtual.5: ../proto/virtual
	../mantools/srctoman - $? >$@
