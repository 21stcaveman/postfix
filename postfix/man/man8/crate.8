.TH CRATE 8 
.ad
.fi
.SH NAME
crate
\-
Postfix connection count and rate management
.SH SYNOPSIS
.na
.nf
\fBcrate\fR [generic Postfix daemon options]
.SH DESCRIPTION
.ad
.fi
The Postfix \fBcrate\fR server maintains statistics that other
Postfix servers can use to limit the number of simultaneous
connections as well as the frequency of connection attempts
over a configurable unit of time.
This server is designed to run under control by the Postfix
master server.
.SH PROTOCOL
.na
.nf
.ad
.fi
When a connection is established, a rate limited server
sends the following request to the \fBcrate\fR server:
.PP
.in +4
\fBrequest=connect\fR
.br
\fBident=\fIstring\fR
.in
.PP
This registers a new connection for the remote client and the rate
limited service specified with \fIstring\fR. The \fBcrate\fR server
answers with the number of simultaneous connections and the
number of connections per unit time for that (service, client)
combination:
.PP
.in +4
\fBstatus=0\fR
.br
\fBcount=\fInumber\fR
.br
\fBrate=\fInumber\fR
.in
.PP
It is left up to the rate limited service to decide if the
remote client connection request is acceptable.
.PP
When a remote client disconnects, a rate limited server
sends the following request to the \fBcrate\fR server:
.PP
.in +4
\fBrequest=disconnect\fR
.br
\fBident=\fIstring\fR
.in
.PP
This registers a disconnect event for the remote client and the rate
limited service specified with \fIstring\fR. The rate limit management
server replies with:
.PP
.ti +4
\fBstatus=0\fR
.PP
.SH SECURITY
.na
.nf
.ad
.fi
The connection count and rate management service is not security
sensitive. It does not talk to the network or local users,
and it can run chrooted at fixed low privilege.

This server maintains an in-memory table with information about
past and current clients of a rate limited service. Although state
is kept only temporarily, this may require a lot of memory when a
system handles connections from many remote clients, or when a system
comes under a distributed denial of service attack. In that case,
reduce the time unit over which statistics are kept.

Systems behind network address translating routers or proxies
appear to have the same client address and can run into connection
count and/or rate limits falsely.
.SH DIAGNOSTICS
.ad
.fi
Problems and transactions are logged to \fBsyslogd\fR(8).
.SH BUGS
.ad
.fi
All state is lost when the service is restarted.

In this first implementation, a count or rate limited server
can have only one client at a time.
.SH CONFIGURATION PARAMETERS
.na
.nf
.ad
.fi
The following \fBmain.cf\fR parameters are especially relevant to
this program. Use the \fBpostfix reload\fR command after
a configuration change.
.IP \fBconnection_rate_purge_delay\fR
How long remote client state is remembered after the remote client
has disconnected completely. This should not be smaller than the
unit of time over which connection rates are calculated.
.IP \fBconnection_rate_time_unit\fR
The unit of time over which connection rates are calculated.
.SH SEE ALSO
.na
.nf
smtpd(8) Postfix SMTP server
.SH LICENSE
.na
.nf
.ad
.fi
The Secure Mailer license must be distributed with this software.
.SH AUTHOR(S)
.na
.nf
Wietse Venema
IBM T.J. Watson Research
P.O. Box 704
Yorktown Heights, NY 10598, USA
