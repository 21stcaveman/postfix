#++
# NAME
#	mongodb_table 5
# SUMMARY
#	Postfix MongoDB client configuration
# SYNOPSIS
#	\fBpostmap -q "\fIstring\fB" mongodb:/etc/postfix/\fIfilename\fR
#
#	\fBpostmap -q - mongodb:/etc/postfix/\fIfilename\fB <\fIinputfile\fR
#
#	\fBpostmap -q "\fIstring\fB" mongodb:\fI<main_cf_variable_name>\fB
# DESCRIPTION
#	The Postfix mail system uses optional tables for address
#	rewriting or mail routing. These tables are usually in
#	\fBdbm\fR or \fBdb\fR format.
#
#	Alternatively, lookup tables can be specified as MongoDB databases.
#	In order to use MongoDB lookups, define a MongoDB source as a lookup
#	table in main.cf, for example:
# .nf
#	    alias_maps = mongodb:/etc/postfix/mongodb-aliases.cf
# .fi
#
#	The file /etc/postfix/mongodb-aliases.cf has the same format as
#	the Postfix main.cf file, and can specify the parameters
#	described below.
#
#	It is strongly recommended to use proxy, in order to reduce the number of
#	database connections. For example:
# .nf
#	    alias_maps = proxy:mongodb:/etc/postfix/mongodb-aliases.cf
# .fi
#
# MONGODB PARAMETERS
# .ad
# .fi
# .IP "\fBuri\fR"
#	The URI of mongo server/cluster that Postfix will try to connect 
#	to and query from.
#	Please see \fIhttps://www.mongodb.com/docs/manual/reference/connection-string/\fR
#	Examples:
# .nf
#	    uri = mongodb+srv://user:pass@loclhost:27017/mail
# .fi
#
# .fi
# .IP "\fBdbname\fR"
#	Name of the database to read the information from.
#	Example:
# .nf
#	    dbname = mail
# .fi
# .IP "\fBcollection\fR"
#	Name of the collection (table) to read the information from.
# .nf
#	    collection = mailbox
# .fi
# .IP "\fBfilter\fR"
#	The MongoDB query template used to search the database, where \fB%s\fR
#	is a substitute for the address Postfix is trying to resolve,
#	Please see \fIhttps://www.mongodb.com/docs/manual/tutorial/query-documents/\fR
#
#	e.g.
# .nf
#	    filter = {"$$or": [{"username":"%s"}, {"alias.address": "%s"}], "active": 1}
# .fi
#
#	This parameter supports the following '%' expansions:
# .RS
# .IP "\fB%%\fR"
#	This is replaced by a literal '%' character.
# .IP "\fB$$\fR"
#	This is replaced by a literal '$' character.
# .IP "\fB%s\fR"
#	This is replaced by the input key.
#	No quoting is applied. This is to allow for different data type searches.
#	for example, {"key": %s} differs from {"key": "%s"} in that the second
#	query searches for a string type, where is the first can be looking for a number.
# .IP "\fB%u\fR"
#	When the input key is an address of the form user@domain, \fB%u\fR
#	is replaced by the local part of the address.
#	Otherwise, \fB%u\fR is replaced by the entire search string.
# .IP "\fB%d\fR"
#	When the input key is an address of the form user@domain, \fB%d\fR
#	is replaced by the domain part of the address.
# .IP "\fB%[1-9]\fR"
#	The patterns %1, %2, ... %9 are replaced by the corresponding
#	most significant component of the input key's domain. If the
#	input key is \fIuser@mail.example.com\fR, then %1 is \fBcom\fR,
#	%2 is \fBexample\fR and %3 is \fBmail\fR.
# .RE
# .IP "\fBresult_attribute\fR"
#	Comma seperated list of fields to be returned.
# .RS
# .IP "\fBresult_format (default: \fB%s\fR)\fR"
#	Called \fBresult_filter\fR in Postfix releases prior to 2.2.
#	Format template applied to result attributes. Most commonly used
#	to append (or prepend) text to the result. This parameter supports
#	the following '%' expansions:
# .RS
# .IP "\fB%%\fR"
#	This is replaced by a literal '%' character. (Postfix 2.2 and later).
# .IP "\fB%s\fR"
#	This is replaced by the value of the result attribute. When
#	result is empty it is skipped.
# .IP "\fB%u\fR
#	When the result attribute value is an address of the form
#	user@domain, \fB%u\fR is replaced by the local part of the
#	address. When the result has an empty localpart it is skipped.
# .IP "\fB%d\fR"
#	When a result attribute value is an address of the form
#	user@domain, \fB%d\fR is replaced by the domain part of
#	the attribute value. When the result is unqualified it
#	is skipped.
# .IP "\fB%[SUD1-9]\fR"
#	The upper-case and decimal digit expansions interpolate
#	the parts of the input key rather than the result. Their
#	behavior is identical to that described with \fBquery_filter\fR,
#	and in fact because the input key is known in advance, lookups
#	whose key does not contain all the information specified in
#	the result template are suppressed and return no results.
# .IP
#	The above %S, %U, %D and %1, ..., %9 expansions are available with
#	Postfix 2.2 and later.
# .RE
# .IP
#	For example, using "result_format = smtp:[%s]" allows one
#	to use a mailHost attribute as the basis of a transport(5)
#	table. After applying the result format, multiple values
#	are concatenated as comma separated strings. The expansion_limit
#	parameter explained below allows one to restrict the number of 
#	values in the result, which is especially useful for maps that 
#	should return a single value.
#
#	The default value \fB%s\fR specifies that each
#	attribute value should be used as is.
#
#	This parameter was called \fBresult_filter\fR in Postfix
#	releases prior to 2.2. If no "result_format" is specified,
#	the value of "result_filter" will be used instead before
#	resorting to the default value. This provides compatibility
#	with old configuration files.
#
#	NOTE: DO NOT put quotes around the result format!
# .IP "\fBdomain (default: no domain list)\fR"
#	This is a list of domain names, paths to files, or
#	"type:table" databases. When specified, only fully qualified search
#	keys with a *non-empty* localpart and a matching domain
#	are eligible for lookup: 'user' lookups, bare domain lookups
#	and "@domain" lookups are not performed. This can significantly
#	reduce the query load on the backend database.
#
# .nf
#	    domain = postfix.org, hash:/etc/postfix/searchdomains
# .fi
# .IP "\fBexpansion_limit (default: 0)\fR"
#	A limit on the total number of result elements returned
#	(as a comma separated list) by a lookup against the map.
#	A setting of zero disables the limit. Lookups fail with a
#	temporary error if the limit is exceeded.  Setting the
#	limit to 1 ensures that lookups do not return multiple
#	values.
# SEE ALSO
#	postmap(1), Postfix lookup table maintenance
#	postconf(5), configuration parameters
# README FILES
# .ad
# .fi
#	Use "\fBpostconf readme_directory\fR" or
#	"\fBpostconf html_directory\fR" to locate this information.
# .na
# .nf
#	DATABASE_README, Postfix lookup table overview
#	MONGODB_README, Postfix MONGODB client guide
# LICENSE
# .ad
# .fi
#	The Secure Mailer license must be distributed with this software.
# HISTORY
#	MongoDB support was introduced with Postfix version 3.9.
# AUTHOR(S)
#	Hamid Maadani (hamid@dexo.tech)
#	Dextrous Technologies, LLC
#	P.O. Box 213
#	5627 Kanan Rd.,
#	Agoura Hills, CA, USA#
#
# Based on the work done by:
#	Stephan Ferraro, Aionda GmbH
#	E-Mail: stephan@ferraro.net
#
#	Victor Duchovni
#
#	Wietse Venema
#	Google, Inc.
#	111 8th Avenue
#	New York, NY 10011, USA
#--
