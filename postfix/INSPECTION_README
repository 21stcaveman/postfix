This is a very first implementation of Postfix content inspection.
It involves an incompatible change to queue file formats.  Older
Postfix versions will move the mail aside to the "corrupt" mail
queue subdirectory.

The example uses content inspection software that can receive and
deliver mail via SMTP. At present, Postfix can receive already
inspected mail only via SMTP. In the future it may become possible
to submit already filtered mail via the postdrop command. However,
doing business over SMTP is much less inefficient.

We will set up a content inspector program listening on localhost
port 10025 that receives mail via the SMTP protocol, and that
submits mail back into Postfix via localhost port 10026.

      ..................................
      .            Postfix             .
   ------smtpd \                /local-----
      .         -cleanup->queue-       .
   -----pickup /    ^       |   \smtp------
      .             |       v          .
      .           smtpd    smtp        .
      .           10026     |          .
      ......................|...........
                    ^       |
                    |       v
                ....|............
                .   |     10025 .
                .   inspector   .
                .               .
                .................

To enable content inspection in this manner, specify in main.cf a
new parameter:

    /etc/postfix/main.cf:
	content_inspector = smtp:localhost:10025

This causes Postfix to add one extra content inspection record to
each incoming mail message, with content smtp:localhost:10025.
You can use the same syntax as in the right-hand side of a Postfix
transport table.  The content inspection records are added by the
smtpd and pickup servers.

When a queue file has content inspection information, the queue
manager will deliver the mail to the specified content inspector
regardless of its final destination.

Setting up the content inspector could be done with the Postfix
spawn service, to instantiate up to 10 processes on demand:

    /etc/postfix/master.cf:
	localhost:10025     inet  -      n      n      -      10     spawn
	    user=inspect argv=/some/where/inspect localhost 10026

The spawn server is part of Postfix but is not installed by default.
Edit the top-level Makefile.in file, run "make makefiles", "make",
and "make install".

The /some/where/inspect command is most likely a PERL script. PERL
has modules that make talking SMTP easy. The command-line specifies
that mail shouldbe sent back into Postfix via localhost port 10026.

The job of the content inspector is to either bounce mail with a
suitable diagnostic, or to feed the mail back into Postfix through
a dedicated listener on port localhost 10026:

    /etc/postfix/master.cf:
        localhost:10026     inet  n      -      n      -      0      smtpd
	    -o content_inspector= myhostname=localhost.domain.name

This is just another SMTP server. It is configured NOT to request
content inspection for incoming mail, has no process limit (so
Postfix will not deadlock), and is configured to use a different
hostname in the greeting message (this is necessary for testing
when I simply use no inspector program and let the SMTP content
inspection interfaces talk directly to each other).
