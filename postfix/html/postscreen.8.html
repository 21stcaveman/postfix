<!doctype html public "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<title> Postfix manual - postscreen(8) </title>
</head> <body> <pre>
POSTSCREEN(8)                                                    POSTSCREEN(8)

<b>NAME</b>
       postscreen - Postfix SMTP triage server

<b>SYNOPSIS</b>
       <b>postscreen</b> [generic Postfix daemon options]

<b>DESCRIPTION</b>
       The Postfix <a href="postscreen.8.html"><b>postscreen</b>(8)</a> server performs triage on multi-
       ple inbound SMTP connections in parallel. The program  can
       run in two basic modes.

       The  purpose  of <b>observation mode</b> is to collect statistics
       without actually blocking mail. <a href="postscreen.8.html"><b>postscreen</b>(8)</a> runs a  num-
       ber  of  tests  before  it forwards a connection to a real
       SMTP server process.  These tests introduce a delay  of  a
       few  seconds;  once  a client passes the tests as "clean",
       its IP address is temporarily whitelisted  and  subsequent
       connections  incur no delays until the temporary whitelist
       entry expires.

       The purpose of <b>enforcement mode</b> is to block  mail  without
       using up one Postfix SMTP server process for every connec-
       tion.  Here,  <a href="postscreen.8.html"><b>postscreen</b>(8)</a>  terminates  connections  from
       SMTP  clients that fail the above tests, and forwards only
       the remaining connections to a real SMTP  server  process.
       By  running  time-consuming  spam  tests  in  parallel  in
       <a href="postscreen.8.html"><b>postscreen</b>(8)</a>, more Postfix SMTP server  processes  remain
       available for legitimate clients.

       Note:  <a href="postscreen.8.html"><b>postscreen</b>(8)</a>  is not an SMTP proxy; this is inten-
       tional. The purpose is to  prioritize  legitimate  clients
       with as little overhead as possible.

       <a href="postscreen.8.html"><b>postscreen</b>(8)</a> performs tests in the order described below.

<b>1. PERMANENT WHITELIST TEST</b>
       The  <a href="postconf.5.html#postscreen_whitelist_networks">postscreen_whitelist_networks</a>   parameter   (default:
       $<a href="postconf.5.html#mynetworks">mynetworks</a>)  specifies  a  permanent  whitelist  for SMTP
       client  IP  addresses.   This  feature  is  not  used  for
       addresses that appear on the permanent blacklist.

       When   the  SMTP  client  address  matches  the  permanent
       whitelist, this is logged as:

       <b>WHITELISTED</b> <i>address</i>

       The action is not configurable:  immediately  forward  the
       connection to a real SMTP server process.

<b>2. PERMANENT BLACKLIST TEST</b>
       The   <a href="postconf.5.html#postscreen_blacklist_networks">postscreen_blacklist_networks</a>   parameter  (default:
       empty) specifies a permanent blacklist for SMTP client  IP
       addresses.  The address syntax is as with <a href="postconf.5.html#mynetworks">mynetworks</a>.

       When  the SMTP client address matches the permanent black-
       list, this is logged as:

       <b>BLACKLISTED</b> <i>address</i>

       The <a href="postconf.5.html#postscreen_blacklist_action">postscreen_blacklist_action</a>  parameter  specifies  the
       action that is taken next:

       <b>continue</b> (default, observation mode)
              Continue  with the SMTP GREETING PHASE TESTS below.

       <b>drop</b> (enforcement mode)
              Drop the connection immediately  with  a  521  SMTP
              reply.   In a future implementation, the connection
              may instead be passed  to  a  dummy  SMTP  protocol
              engine  that logs sender and recipient information.

<b>3. TEMPORARY WHITELIST TEST</b>
       The <a href="postscreen.8.html"><b>postscreen</b>(8)</a> daemon maintains a  <i>temporary</i>  whitelist
       for  SMTP  client  IP  addresses  that have passed all the
       tests described below. The <a href="postconf.5.html#postscreen_cache_map">postscreen_cache_map</a>  parameter
       specifies  the  location  of the temporary whitelist.  The
       temporary whitelist is not used for SMTP client  addresses
       that appear on the <i>permanent</i> blacklist or whitelist.

       When  the  SMTP  client  address  appears on the temporary
       whitelist, this is logged as:

       <b>PASS OLD</b> <i>address</i>

       The action is not configurable:  immediately  forward  the
       connection  to  a real SMTP server process.  The client is
       excluded from further tests until its temporary  whitelist
       entry expires, as controlled with the <a href="postconf.5.html#postscreen_cache_ttl">postscreen_cache_ttl</a>
       parameter.  Expired entries are silently renewed if possi-
       ble.

<b>4. SMTP GREETING PHASE TESTS</b>
       The   <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a>  parameter  specifies  a  time
       interval during which <a href="postscreen.8.html"><b>postscreen</b>(8)</a> runs a number of tests
       as described below.  These tests run before the client may
       see the real SMTP server's "220 text..." server  greeting.

       When  the SMTP client passes all the tests, this is logged
       as:

       <b>PASS NEW</b> <i>address</i>

       The action is to forward the connection  to  a  real  SMTP
       server  process  and to create a temporary whitelist entry
       that excludes the client IP  address  from  further  tests
       until the temporary whitelist entry expires, as controlled
       with the <a href="postconf.5.html#postscreen_cache_ttl">postscreen_cache_ttl</a> parameter.

       In a future implementation, the connection  may  first  be
       passed  to  a  dummy  SMTP protocol engine that implements
       more protocol  tests  including  greylisting,  before  the
       client is allowed to talk to a real SMTP server process.

<b>4A. PREGREET TEST</b>
       The  <a href="postconf.5.html#postscreen_greet_banner">postscreen_greet_banner</a>  parameter specifies the text
       for a "220-text..." teaser  banner  (default:  $<a href="postconf.5.html#smtpd_banner">smtpd_ban</a>-
       <a href="postconf.5.html#smtpd_banner">ner</a>).   The  <a href="postscreen.8.html"><b>postscreen</b>(8)</a>  daemon  sends  this before the
       <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> timer is started.   The  purpose  of
       the  teaser banner is to confuse SPAM clients so that they
       speak before their turn. It has no effect on SMTP  clients
       that correctly implement the protocol.

       To  avoid  problems  with  broken  SMTP engines in network
       appliances, either exclude them from all  tests  with  the
       <a href="postconf.5.html#postscreen_whitelist_networks">postscreen_whitelist_networks</a>  feature  or else specify an
       empty  <a href="postconf.5.html#postscreen_greet_banner">postscreen_greet_banner</a>  value   to   disable   the
       "220-text..."  teaser banner.

       When   an   SMTP   client   sends  a  command  before  the
       <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> time has elapsed, this is logged as:

       <b>PREGREET</b> <i>count</i> <b>after</b> <i>time</i> <b>from</b> <i>address text...</i>

       Translation: the client at <i>address</i> sent <i>count</i> bytes before
       its turn to speak, and this happened  <i>time</i>  seconds  after
       the  <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> timer was started.  The <i>text</i> is
       what the client sent (truncated to  100  bytes,  and  with
       non-printable characters replaced with "?").

       The <a href="postconf.5.html#postscreen_greet_action">postscreen_greet_action</a> parameter specifies the action
       that is taken next:

       <b>continue</b> (default, observation mode)
              Wait  until  the  <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a>  time   has
              elapsed, then report DNSBL lookup results if appli-
              cable. Either perform DNSBL-related actions or for-
              ward  the connection to a real SMTP server process.

       <b>drop</b> (enforcement mode)
              Drop the connection immediately  with  a  521  SMTP
              reply.   In a future implementation, the connection
              may instead be passed  to  a  dummy  SMTP  protocol
              engine  that logs sender and recipient information.

<b>4B. HANGUP TEST</b>
       When the SMTP client hangs up  without  sending  any  data
       before the <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> time has elapsed, this is
       logged as:

       <b>HANGUP after</b> <i>time</i> <b>from</b> <i>address</i>

       The <a href="postconf.5.html#postscreen_hangup_action">postscreen_hangup_action</a> specifies the action that  is
       taken next:

       <b>continue</b> (default, observation mode)
              Wait   until  the  <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a>  time  has
              elapsed, then report DNSBL lookup results if appli-
              cable.  Do  not  forward the broken connection to a
              real SMTP server process.

       <b>drop</b> (enforcement mode)
              Drop the connection immediately.

<b>4C. DNS BLOCKLIST TEST</b>
       The  <a href="postconf.5.html#postscreen_dnsbl_sites">postscreen_dnsbl_sites</a>  parameter  (default:   empty)
       specifies a list of DNS blocklist servers.

       When  the  <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> time has elapsed, and the
       SMTP client address is listed with at least one  of  these
       blocklists, this is logged as:

       <b>DNSBL rank</b> <i>count</i> <b>for</b> <i>address</i>

       Translation:  the  client  at <i>address</i> is listed with <i>count</i>
       DNSBL servers. The <i>count</i> does not depend on the number  of
       DNS records that an individual DNSBL server returns.

       The <a href="postconf.5.html#postscreen_dnsbl_action">postscreen_dnsbl_action</a> parameter specifies the action
       that is taken next:

       <b>continue</b> (default, observation mode)
              Forward  the  connection  to  a  real  SMTP  server
              process.

       <b>drop</b> (enforcement mode)
              Drop  the  connection  immediately  with a 521 SMTP
              reply.  In a future implementation, the  connection
              may  instead  be  passed  to  a dummy SMTP protocol
              engine that logs sender and recipient  information.

<b>SECURITY</b>
       The <a href="postscreen.8.html"><b>postscreen</b>(8)</a> server is moderately security-sensitive.
       It talks to untrusted clients on the network. The  process
       can be run chrooted at fixed low privilege.

<b>STANDARDS</b>
       <a href="http://tools.ietf.org/html/rfc5321">RFC 5321</a> (SMTP, including multi-line 220 greetings)
       <a href="http://tools.ietf.org/html/rfc2920">RFC 2920</a> (SMTP Pipelining)

<b>DIAGNOSTICS</b>
       Problems and transactions are logged to <b>syslogd</b>(8).

<b>CONFIGURATION PARAMETERS</b>
       Changes  to  <a href="postconf.5.html">main.cf</a>  are  not picked up automatically, as
       <a href="postscreen.8.html"><b>postscreen</b>(8)</a> processes may run for  several  hours.   Use
       the command "postfix reload" after a configuration change.

       The text below provides  only  a  parameter  summary.  See
       <a href="postconf.5.html"><b>postconf</b>(5)</a> for more details including examples.

<b>TRIAGE PARAMETERS</b>
       <b><a href="postconf.5.html#postscreen_blacklist_action">postscreen_blacklist_action</a> (continue)</b>
              The  action  that  <a href="postscreen.8.html"><b>postscreen</b>(8)</a> takes when an SMTP
              client  is   permanently   blacklisted   with   the
              <a href="postconf.5.html#postscreen_blacklist_networks">postscreen_blacklist_networks</a> parameter.

       <b><a href="postconf.5.html#postscreen_blacklist_networks">postscreen_blacklist_networks</a> (empty)</b>
              Network addresses that are permanently blacklisted;
              see the <a href="postconf.5.html#postscreen_blacklist_action">postscreen_blacklist_action</a>  parameter  for
              possible actions.

       <b><a href="postconf.5.html#postscreen_cache_map">postscreen_cache_map</a> (btree:$<a href="postconf.5.html#data_directory">data_directory</a>/ps_whitelist)</b>
              Persistent  storage  for  the  <a href="postscreen.8.html"><b>postscreen</b>(8)</a> server
              decisions.

       <b><a href="postconf.5.html#postscreen_cache_ttl">postscreen_cache_ttl</a> (1d)</b>
              The amount of time that <a href="postscreen.8.html"><b>postscreen</b>(8)</a> will cache  a
              decision for a specific SMTP client IP address.

       <b><a href="postconf.5.html#postscreen_dnsbl_action">postscreen_dnsbl_action</a> (continue)</b>
              The  action  that  <a href="postscreen.8.html"><b>postscreen</b>(8)</a> takes when an SMTP
              client is listed at the DNS blocklist domains spec-
              ified with the <a href="postconf.5.html#postscreen_dnsbl_sites">postscreen_dnsbl_sites</a> parameter.

       <b><a href="postconf.5.html#postscreen_dnsbl_sites">postscreen_dnsbl_sites</a> (empty)</b>
              Optional list of DNS blocklist domains.

       <b><a href="postconf.5.html#postscreen_greet_action">postscreen_greet_action</a> (continue)</b>
              The  action  that  <a href="postscreen.8.html"><b>postscreen</b>(8)</a> takes when an SMTP
              client speaks before its turn within the time spec-
              ified with the <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> parameter.

       <b><a href="postconf.5.html#postscreen_greet_banner">postscreen_greet_banner</a> ($<a href="postconf.5.html#smtpd_banner">smtpd_banner</a>)</b>
              The  text  in  the  optional  "220-text..."  server
              response that <a href="postscreen.8.html"><b>postscreen</b>(8)</a> sends ahead of the real
              Postfix SMTP server's "220 text..." response, in an
              attempt to confuse bad SMTP clients  so  that  they
              speak before their turn (pre-greet).

       <b><a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a> (4s)</b>
              The amount of time that <a href="postscreen.8.html"><b>postscreen</b>(8)</a> will wait for
              an SMTP client to send a command before  its  turn,
              and for DNS blocklist lookup results to arrive.

       <b><a href="postconf.5.html#postscreen_hangup_action">postscreen_hangup_action</a> (continue)</b>
              The  action  that  <a href="postscreen.8.html"><b>postscreen</b>(8)</a> takes when an SMTP
              client disconnects without sending data, within the
              time   specified   with  the  <a href="postconf.5.html#postscreen_greet_wait">postscreen_greet_wait</a>
              parameter.

       <b><a href="postconf.5.html#postscreen_post_queue_limit">postscreen_post_queue_limit</a> ($<a href="postconf.5.html#default_process_limit">default_process_limit</a>)</b>
              The number of clients that can be waiting for  ser-
              vice from a real SMTP server process.

       <b><a href="postconf.5.html#postscreen_pre_queue_limit">postscreen_pre_queue_limit</a> ($<a href="postconf.5.html#default_process_limit">default_process_limit</a>)</b>
              The  number  of non-whitelisted clients that can be
              waiting for a decision whether  they  will  receive
              service from a real SMTP server process.

       <b><a href="postconf.5.html#postscreen_whitelist_networks">postscreen_whitelist_networks</a> ($<a href="postconf.5.html#mynetworks">mynetworks</a>)</b>
              Network addresses that are permanently whitelisted,
              and that will not  be  subjected  to  <a href="postscreen.8.html"><b>postscreen</b>(8)</a>
              checks.

       <b><a href="postconf.5.html#smtpd_service">smtpd_service</a> (smtpd)</b>
              The  internal  service  that <a href="postscreen.8.html"><b>postscreen</b>(8)</a> forwards
              allowed connections to.

<b>MISCELLANEOUS CONTROLS</b>
       <b><a href="postconf.5.html#config_directory">config_directory</a> (see 'postconf -d' output)</b>
              The default location of  the  Postfix  <a href="postconf.5.html">main.cf</a>  and
              <a href="master.5.html">master.cf</a> configuration files.

       <b><a href="postconf.5.html#daemon_timeout">daemon_timeout</a> (18000s)</b>
              How  much time a Postfix daemon process may take to
              handle a request  before  it  is  terminated  by  a
              built-in watchdog timer.

       <b><a href="postconf.5.html#delay_logging_resolution_limit">delay_logging_resolution_limit</a> (2)</b>
              The  maximal  number  of  digits  after the decimal
              point when logging sub-second delay values.

       <b><a href="postconf.5.html#command_directory">command_directory</a> (see 'postconf -d' output)</b>
              The location of  all  postfix  administrative  com-
              mands.

       <b><a href="postconf.5.html#ipc_timeout">ipc_timeout</a> (3600s)</b>
              The time limit for sending or receiving information
              over an internal communication channel.

       <b><a href="postconf.5.html#max_idle">max_idle</a> (100s)</b>
              The maximum amount of time  that  an  idle  Postfix
              daemon  process  waits  for  an incoming connection
              before terminating voluntarily.

       <b><a href="postconf.5.html#process_id">process_id</a> (read-only)</b>
              The process ID  of  a  Postfix  command  or  daemon
              process.

       <b><a href="postconf.5.html#process_name">process_name</a> (read-only)</b>
              The  process  name  of  a Postfix command or daemon
              process.

       <b><a href="postconf.5.html#syslog_facility">syslog_facility</a> (mail)</b>
              The syslog facility of Postfix logging.

       <b><a href="postconf.5.html#syslog_name">syslog_name</a> (see 'postconf -d' output)</b>
              The mail system  name  that  is  prepended  to  the
              process  name  in  syslog  records, so that "smtpd"
              becomes, for example, "postfix/smtpd".

<b>SEE ALSO</b>
       <a href="smtpd.8.html">smtpd(8)</a>, Postfix SMTP server
       <a href="dnsblog.8.html">dnsblog(8)</a>, temporary DNS helper
       syslogd(8), system logging

<b>LICENSE</b>
       The Secure Mailer license must be  distributed  with  this
       software.

<b>AUTHOR(S)</b>
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

                                                                 POSTSCREEN(8)
</pre> </body> </html>
