<html> <head> </head> <body> <pre>



VIRTUAL(8)                                             VIRTUAL(8)


<b>NAME</b>
       virtual - Postfix virtual domain mail delivery agent

<b>SYNOPSIS</b>
       <b>virtual</b> [generic Postfix daemon options]

<b>DESCRIPTION</b>
       This  daemon  is  designed for ISP's offering virtual mail
       hosting services. Originally based on the  local  delivery
       agent,  this  agent locates user mailboxes via map lookups
       of the full recipient address, rather than hard-coded unix
       password file searches of the local part only.

       The  <b>virtual</b>  daemon  processes delivery requests from the
       Postfix queue manager to deliver  mail  to  virtual  local
       recipients.  Each delivery request specifies a queue file,
       a sender address, a domain or host to deliver to, and  one
       or  more  recipients.  This program expects to be run from
       the <a href="master.8.html"><b>master</b>(8)</a> process manager.

       The <b>virtual</b> daemon updates queue files and  marks  recipi-
       ents  as  finished,  or  it informs the queue manager that
       delivery should be tried again at a later  time.  Delivery
       problem reports are sent to the <a href="bounce.8.html"><b>bounce</b>(8)</a> or <a href="defer.8.html"><b>defer</b>(8)</a> dae-
       mon as appropriate.

<b>MAILBOX</b> <b>DELIVERY</b>
       The <b>virtual</b> delivery agent can deliver to UNIX-style mail-
       box file or to qmail-style maildir files. The pathname and
       delivery mailbox style are controlled by the <b>virtual</b><i>_</i><b>mail-</b>
       <b>box</b><i>_</i><b>base</b> and <b>virtual</b><i>_</i><b>mailbox</b><i>_</i><b>maps</b> configuration parameters
       (see below).

       In the case of UNIX-style mailbox delivery, the <b>local</b> dae-
       mon prepends a "<b>From</b> <i>sender</i> <i>time_stamp</i>" envelope header to
       each message, prepends a  <b>Delivered-To:</b>  header  with  the
       envelope recipient address, prepends a <b>Return-Path:</b> header
       with the envelope sender address, prepends a  &gt;  character
       to  lines  beginning  with  "<b>From</b>  ", and appends an empty
       line.  The mailbox is locked for  exclusive  access  while
       delivery  is  in progress. In case of problems, an attempt
       is made to truncate the mailbox to its original length.

       In the case of <b>maildir</b> delivery, the local daemon prepends
       a <b>Delivered-To:</b> header with the envelope recipient address
       and prepends  a  <b>Return-Path:</b>  header  with  the  envelope
       sender address.

<b>DELIVERY</b> <b>RIGHTS</b>
       Deliveries  are  made  with  the user and group privileges
       that are listed in the  tables  specified  with  the  <b>vir-</b>
       <b>tual</b><i>_</i><b>uid</b><i>_</i><b>maps</b> and <b>virtual</b><i>_</i><b>gid</b><i>_</i><b>maps</b>, respectively.

       The  <b>virtual</b><i>_</i><b>minimum</b><i>_</i><b>uid</b> parameter specifies a lower bound



                                                                1





VIRTUAL(8)                                             VIRTUAL(8)


       on  user  ID  values  that  may  be  specified   in   <b>vir-</b>
       <b>tual</b><i>_</i><b>uid</b><i>_</i><b>maps</b>.  Mail  will not be delivered when a too low
       UID value is found.

<b>STANDARDS</b>
       <a href="http://www.faqs.org/rfcs/rfc822.html">RFC 822</a> (ARPA Internet Text Messages)

<b>DIAGNOSTICS</b>
       Problems and transactions are logged to <b>syslogd</b>(8).   Cor-
       rupted  message files are marked so that the queue manager
       can move them to the <b>corrupt</b> queue afterwards.

       Depending on the setting of the <b>notify</b><i>_</i><b>classes</b>  parameter,
       the  postmaster  is notified of bounces and of other trou-
       ble.

<b>CONFIGURATION</b> <b>PARAMETERS</b>
       The following <b>main.cf</b> parameters are  especially  relevant
       to  this  program. See the Postfix <b>main.cf</b> file for syntax
       details and for default values.  Use  the  <b>postfix</b>  <b>reload</b>
       command after a configuration change.

<b>Mailbox</b> <b>delivery</b>
       <b>virtual</b><i>_</i><b>mailbox</b><i>_</i><b>base</b>
              Specifies  a  path that is prepended to all mailbox
              or maildir paths.  This  is  a  safety  measure  to
              ensure  that an out of control map in <b>virtual</b><i>_</i><b>mail-</b>
              <b>box</b><i>_</i><b>maps</b> doesn't litter the filesystem  with  mail-
              boxes.   While it could be set to "/", this setting
              isn't recommended.

       <b>virtual</b><i>_</i><b>mailbox</b><i>_</i><b>maps</b>
              Recipients are looked up in this map  to  determine
              the  path  to  their  mailbox  or  maildir.  If the
              returned path ends in a slash ("/"),  maildir-style
              delivery  is  carried  out,  otherwise  the path is
              assumed to specify a mailbox file.

              Note that <b>virtual</b><i>_</i><b>mailbox</b><i>_</i><b>base</b>  is  unconditionally
              prepended to this path.

       <b>virtual</b><i>_</i><b>minimum</b><i>_</i><b>uid</b>
              Specifies  a minimum uid that will be accepted as a
              return from  a  <b>virtual</b><i>_</i><b>uid</b><i>_</i><b>maps</b>  lookup.  Returned
              values  less  than  this  will be rejected, and the
              message will be deferred.

       <b>virtual</b><i>_</i><b>uid</b><i>_</i><b>maps</b>
              Recipients are looked up in this map  to  determine
              the UID to be used when writing to the target mail-
              box.

       <b>virtual</b><i>_</i><b>gid</b><i>_</i><b>maps</b>
              Recipients are looked up in this map  to  determine



                                                                2





VIRTUAL(8)                                             VIRTUAL(8)


              the GID to be used when writing to the target mail-
              box.

<b>Locking</b> <b>controls</b>
       <b>mailbox</b><i>_</i><b>delivery</b><i>_</i><b>lock</b>
              How to lock UNIX-style mailboxes: one  or  more  of
              <b>flock</b>, <b>fcntl</b> or <b>dotlock</b>.

              Use  the command <b>postconf</b> <b>-m</b> to find out what lock-
              ing methods are available on your system.

       <b>deliver</b><i>_</i><b>lock</b><i>_</i><b>attempts</b>
              Limit the number of attempts to acquire  an  exclu-
              sive lock on a mailbox file.

       <b>deliver</b><i>_</i><b>lock</b><i>_</i><b>delay</b>
              Time (default: seconds) between successive attempts
              to acquire an exclusive lock on a mailbox file.

       <b>stale</b><i>_</i><b>lock</b><i>_</i><b>time</b>
              Limit the time after  which  a  stale  lockfile  is
              removed.

<b>Resource</b> <b>controls</b>
       <b>virtual</b><i>_</i><b>destination</b><i>_</i><b>concurrency</b><i>_</i><b>limit</b>
              Limit the number of parallel deliveries to the same
              domain.   The  default  limit  is  taken  from  the
              <b>default</b><i>_</i><b>destination</b><i>_</i><b>concurrency</b><i>_</i><b>limit</b> parameter.

       <b>virtual</b><i>_</i><b>destination</b><i>_</i><b>recipient</b><i>_</i><b>limit</b>
              Limit  the  number of recipients per message deliv-
              ery.   The  default  limit  is   taken   from   the
              <b>default</b><i>_</i><b>destination</b><i>_</i><b>recipient</b><i>_</i><b>limit</b> parameter.

<b>HISTORY</b>
       This  agent  was  originally  based  on the local delivery
       agent. Modifications mainly  consisted  of  removing  code
       that  wasn't  applicable  or  wasn't  safe in this context
       (aliases, .forwards, program aliases).

       The <b>Delivered-To:</b> header appears in the  <b>qmail</b>  system  by
       Daniel Bernstein.

       The  <i>maildir</i>  structure  appears  in  the  <b>qmail</b> system by
       Daniel Bernstein.

<b>SEE</b> <b>ALSO</b>
       <a href="bounce.8.html">bounce(8)</a> non-delivery status reports
       syslogd(8) system logging
       <a href="qmgr.8.html">qmgr(8)</a> queue manager

<b>LICENSE</b>
       The Secure Mailer license must be  distributed  with  this
       software.



                                                                3





VIRTUAL(8)                                             VIRTUAL(8)


<b>AUTHOR(S)</b>
       Wietse Venema
       IBM T.J. Watson Research
       P.O. Box 704
       Yorktown Heights, NY 10598, USA

       Andrew McNamara
       andrewm@connect.com.au
       connect.com.au Pty. Ltd.
       Level 3, 213 Miller St
       North Sydney 2060, NSW, Australia














































                                                                4


</pre> </body> </html>
